<!DOCTYPE html>
<html>
  <head>
    <title>Raspbery Pi Bootstrap</title>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <img src="adafruit.svg">

    <div id="status"></div>

    <div id="ssh" class="hide">
      <label>IP Address:</label>
      <input name="host" value="">
      <label>SSH User:</label>
      <input name="username" value="pi">
      <label>SSH Password</label>
      <input name="password" value="raspberry">
    </div>

    <div id="options" class="hide">
      <label>Hostname:</label>
      <input name="hostname" placeholder="raspberrypi">
      <label>WiFi SSID:</label>
      <input name="wifi_ssid" placeholder="ssid">
      <label>WiFi Password</label>
      <input name="wifi_password" placeholder="******">
    </div>

    <a id="find">Find My Pi!</a>
    <a id="bootstrap" class="hide">Bootstrap!</a>

    <script>

      var ipc = require('ipc');
      window.$ = window.jQuery = require('./jquery.js');

      $(document).on('ready', function() {

        $('#find').click(function() {
          $('img').addClass('spin');
          $(this).hide();
          ipc.send('find');
        });

        $('#bootstrap').click(function() {
          $('img').addClass('spin');
          $(this).hide();
          $('#ssh, #options').hide();
          ipc.send('bootstrap', get_ssh(), get_options());
        });

      });

      ipc.on('found', function(arg) {
        $('img').removeClass('spin');
        $('#options, #ssh, #bootstrap').removeClass('hide');
        $('input[name=host]').val(arg);
        $('#status').html('Found Pi at: ' + arg);
      });

      ipc.on('bootstrap', function(arg) {
        $('#status').html(arg);
        $('img').removeClass('spin');
      });

      ipc.on('status', function(arg) {
        $('#status').html(arg);
      });

      function get_options() {

        var options = {};

        $('#options input').each(function() {

          if($(this).val() === '') {
            return;
          }

          options[$(this).attr('name')] = $(this).val();

        });

        return options;

      }

      function get_ssh() {

        var options = {};

        $('#ssh input').each(function() {
          options[$(this).attr('name')] = $(this).val();
        });

        return options;

      }

    </script>
  </body>
</html>
